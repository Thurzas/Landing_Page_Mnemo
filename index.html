<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mnemo â€” Agent MÃ©moire Personnel</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav>
  <span class="nav-logo">Mnemo</span>
  <ul class="nav-links">
    <li><a href="#session">Session</a></li>
    <li><a href="#philosophy">Philosophie</a></li>
    <li><a href="#pipeline">Pipeline</a></li>
    <li><a href="#ingestion">Ingestion</a></li>
    <li><a href="#stockage">Stockage</a></li>
    <li><a href="#roadmap">Roadmap</a></li>
  </ul>
  <span class="nav-badge">v4 Â· Phase 2 Â· 2026-02-27</span>
</nav>

<div class="hero">
  <div class="hero-orbs">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
  </div>
  <p class="hero-eyebrow">Agent mÃ©moire personnel Â· CrewAI + SQLite + Ollama</p>
  <h1 class="hero-title">
    <span class="line1">Un agent qui</span>
    <span class="line2">se souvient.</span>
  </h1>
  <p class="hero-sub">MÃ©moire hybride long terme, ingestion de documents, retrieval vectoriel et keyword â€” tout tourne localement, hors cloud, sans compromis sur la vie privÃ©e.</p>
  <div class="hero-ctas">
    <a href="#session" class="btn btn-primary"><span>Session du jour</span><span>â†“</span></a>
    <a href="#pipeline" class="btn btn-ghost">388 tests Â· 0 fails</a>
  </div>
  <div class="hero-stats">
    <div class="hstat"><span class="hstat-num">388</span><span class="hstat-label">Tests âœ…</span></div>
    <div class="hstat"><span class="hstat-num">8</span><span class="hstat-label">Tables SQLite</span></div>
    <div class="hstat"><span class="hstat-num">7</span><span class="hstat-label">Formats ingÃ©rÃ©s</span></div>
    <div class="hstat"><span class="hstat-num">13</span><span class="hstat-label">Bugs rÃ©glÃ©s total</span></div>
    <div class="hstat"><span class="hstat-num">100%</span><span class="hstat-label">Local Â· offline</span></div>
  </div>
</div>

<div class="divider"></div>

<!-- â•â• SESSION DU JOUR â•â• -->
<div class="session-section" id="session">
<div>
  <div class="reveal">
    <span class="section-label" style="color:var(--a6);">Session 2026-02-27 (suite)</span>
    <h2 class="section-title">Conscience temporelle,<br>tests &amp; dÃ©duplication.</h2>
    <p class="section-desc">IntÃ©gration calendrier ICS (local + Google), 168 nouveaux tests unitaires, 2 bugs dÃ©tectÃ©s par les tests, upsert par label dans <code>update_markdown_section</code>, et raisonnement temporel passÃ©/prÃ©sent/futur dans le pipeline.</p>
  </div>

  <div class="session-grid reveal">

    <div class="sess-card feat">
      <span class="sess-badge">FEATURE Â· Calendrier</span>
      <div class="sess-title">calendar_tools.py â€” conscience temporelle</div>
      <div class="sess-cause">L'agent ignorait complÃ¨tement l'heure et les Ã©vÃ©nements Ã  venir. Aucune notion de date, impossible de rÃ©pondre Ã  "qu'est-ce que j'ai prÃ©vu ce soir" ou d'horodater les faits consolidÃ©s correctement.</div>
      <div class="sess-fix">Nouveau module : parsing ICS local + URL (Google Calendar, Nextcloud), cache TTL, <code>get_temporal_context()</code> injectÃ© dans les 3 tÃ¢ches, <code>GetCalendarTool</code> CrewAI pour le retriever, banniÃ¨re CLI au dÃ©marrage</div>
    </div>

    <div class="sess-card fix">
      <span class="sess-badge">FIX Â· Performance</span>
      <div class="sess-title">DÃ©lais absurdes + "Maximum iterations reached"</div>
      <div class="sess-cause"><code>max_iter</code> non dÃ©fini â†’ CrewAI utilisait 20 par dÃ©faut. LLM non spÃ©cifiÃ© sur les agents â†’ tentative d'appel OpenAI â†’ timeout â†’ rebouclage jusqu'Ã  Ã©puisement. Chaque message prenait plusieurs minutes.</div>
      <div class="sess-fix"><code>max_iter</code> par rÃ´le (evaluator: 2, retriever: 4, main: 3, writer: 6), <code>LLM(model=MODEL)</code> explicite partout, <code>verbose=False</code> sur tous les agents</div>
    </div>

    <div class="sess-card feat">
      <span class="sess-badge">FEATURE Â· Tests</span>
      <div class="sess-title">168 tests unitaires â€” curiosity &amp; calendrier</div>
      <div class="sess-cause">La CuriosityCrew et le module calendrier n'avaient aucune couverture de tests. Bugs silencieux impossibles Ã  dÃ©tecter sans exÃ©cuter l'agent complet avec Ollama.</div>
      <div class="sess-fix"><code>test_curiosity.py</code> : 79 tests (gaps, labels, Ã©criture, skip, DB) Â· <code>test_calendar_tools.py</code> : 89 tests (datetime FR, ICS parsing, cache TTL, formatage). ZÃ©ro appel Ollama requis</div>
    </div>

    <div class="sess-card fix">
      <span class="sess-badge">FIX Â· DÃ©tection</span>
      <div class="sess-title">Header ### matchait comme alias rÃ©el</div>
      <div class="sess-cause"><code>_extract_section_content()</code> retourne tout en lowercase y compris les headers <code>### prÃ©fÃ©rences &amp; style</code>. L'alias <code>"style"</code> y Ã©tait trouvÃ© â†’ <code>_line_is_real_value()</code> retournait True â†’ champ "Style de communication" jamais dÃ©tectÃ© comme vide. RÃ©vÃ©lÃ© par les tests.</div>
      <div class="sess-fix"><code>_detect_structural_gaps</code> : skip explicite des lignes commenÃ§ant par <code>#</code>. Les titres de sous-section ne sont plus analysÃ©s comme contenu</div>
    </div>

    <div class="sess-card fix">
      <span class="sess-badge">FIX Â· Ã‰criture</span>
      <div class="sess-title">Merge Ã©crasait les vraies valeurs</div>
      <div class="sess-cause"><code>is_placeholder</code> Ã©tait True dÃ¨s qu'UNE ligne du bloc contenait un marqueur. <code>TEMPLATE_PARTIAL</code> avec "Matt" + deux lignes placeholder â†’ tout le bloc remplacÃ© â†’ Matt disparaissait. RÃ©vÃ©lÃ© par les tests.</div>
      <div class="sess-fix">Filtrage ligne par ligne : <code>real_lines</code> = lignes sans marqueur placeholder. Merge = rÃ©elles conservÃ©es + nouveau contenu ajoutÃ©</div>
    </div>

    <div class="sess-card feat">
      <span class="sess-badge">FEATURE Â· Upsert</span>
      <div class="sess-title">Upsert par label dans update_markdown</div>
      <div class="sess-cause"><code>memory.md</code> accumulait des doublons : "Matt", "Thurzas", "Utilisateur" sur trois lignes <code>**Nom/Pseudo**</code>. Chaque session consolidÃ©e ajoutait une nouvelle occurrence sans vÃ©rifier si le label existait dÃ©jÃ .</div>
      <div class="sess-fix">DÃ©tection regex <code>- **Label** : valeur</code> â†’ si label dÃ©jÃ  prÃ©sent : remplace. Si nouveau : appende. Narratif : dÃ©duplication exacte. Impossible d'avoir deux fois le mÃªme label</div>
    </div>

    <div class="sess-card arch">
      <span class="sess-badge">DESIGN Â· Prompt</span>
      <div class="sess-title">RÃ¨gles anti-duplication dans la consolidation</div>
      <div class="sess-cause">Le LLM hallucine des noms ("Thurzas", "Utilisateur") et rÃ©Ã©crit des faits dÃ©jÃ  prÃ©sents (SQLite mentionnÃ© 2 fois). Double responsabilitÃ© : logique Python insuffisante + prompt trop permissif.</div>
      <div class="sess-fix">5 rÃ¨gles explicites dans <code>consolidation_tasks.yaml</code> : ne pas rÃ©Ã©mettre un fait existant, ne pas inventer de noms non mentionnÃ©s, enrichir plutÃ´t que dupliquer les sections narratives</div>
    </div>

    <div class="sess-card arch">
      <span class="sess-badge">DESIGN Â· Temporel</span>
      <div class="sess-title">Raisonnement passÃ© / prÃ©sent / futur</div>
      <div class="sess-cause">L'agent confondait "hier" et "aujourd'hui" : rÃ©pondait avec les Ã©vÃ©nements du calendrier du jour courant pour une question sur la veille. Aucune distinction past/future dans le pipeline d'Ã©valuation.</div>
      <div class="sess-fix"><code>temporal_reference</code> (past|present|future|none) + <code>reference_date</code> ISO calculÃ©e dans <code>evaluate_task</code>. <code>get_yesterday_date_str()</code> dans le contexte temporel. RÃ¨gles de source explicites dans <code>main_task</code></div>
    </div>

  </div>
</div>
</div>

<div class="divider"></div>

<!-- â•â• FORMAT ATOMIQUE / NARRATIF â•â• -->
<div class="schema-section" id="format">
<div>
  <div class="reveal">
    <span class="section-label" style="color:var(--a3);">DÃ©cision d'architecture</span>
    <h2 class="section-title">Atomique ou narratif.<br>Selon la section.</h2>
    <p class="section-desc">Chaque section de <code>memory.md</code> a un format prescrit. Les infos structurÃ©es restent lisibles par code. Les infos contextuelles restent riches pour le retrieval vectoriel.</p>
  </div>

  <div class="schema-two reveal">
    <div class="schema-col">
      <div class="schema-col-title">
        <div class="atomic-dot"></div>
        <span style="color:var(--a3);">Sections atomiques</span>
        <span style="font-size:0.6rem; color:var(--muted); font-weight:400;">â€” ligne labellisÃ©e</span>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a3);">ğŸ§‘ Profil de base</span></div>
        <div class="schema-item-example">- **Nom/Pseudo** : Matt<br>- **MÃ©tier** : dÃ©veloppeur web<br>- **Localisation** : France</div>
        <div class="schema-item-desc">Labels autorisÃ©s : Nom/Pseudo Â· MÃ©tier Â· Localisation Â· Langue prÃ©fÃ©rÃ©e Â· Fuseau horaire</div>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a3);">ğŸ§‘ PrÃ©fÃ©rences & style</span></div>
        <div class="schema-item-example">- **Style de communication** : rÃ©ponses courtes et directes</div>
        <div class="schema-item-desc">Labels autorisÃ©s : Style de communication Â· Ton prÃ©fÃ©rÃ© Â· Langue prÃ©fÃ©rÃ©e</div>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a3);">ğŸ¤– RÃ´le & personnalitÃ© dÃ©finis</span></div>
        <div class="schema-item-example">- **Nom de l'agent** : Mnemo<br>- **RÃ´le** : assistant mÃ©moire personnel</div>
        <div class="schema-item-desc">Labels autorisÃ©s : Nom de l'agent Â· RÃ´le Â· PersonnalitÃ© Â· Langue</div>
      </div>
    </div>

    <div class="schema-col">
      <div class="schema-col-title">
        <div class="narr-dot"></div>
        <span style="color:var(--a2);">Sections narratives</span>
        <span style="font-size:0.6rem; color:var(--muted); font-weight:400;">â€” prose enrichie</span>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a2);">ğŸ“š Projets en cours</span></div>
        <div class="schema-item-example" style="color:var(--muted); font-style:italic;">Agent IA en Python/CrewAI avec mÃ©moire long terme persistante (SQLite + embeddings Ollama). Objectif : personnalisation via memory.md. En cours de dÃ©veloppement actif.</div>
        <div class="schema-item-desc">Prose dÃ©crivant le projet, la stack, l'Ã©tat d'avancement. Plus riche pour le retrieval vectoriel.</div>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a2);">ğŸ“š DÃ©cisions prises</span></div>
        <div class="schema-item-example" style="color:var(--muted); font-style:italic;">Choix de SQLite plutÃ´t qu'une BDD externe pour simplifier le dÃ©ploiement local sans dÃ©pendance rÃ©seau.</div>
        <div class="schema-item-desc">DÃ©cision + contexte + raison. Le "pourquoi" est aussi important que le "quoi".</div>
      </div>

      <div class="schema-item">
        <div class="schema-item-header"><span style="color:var(--a2);">ğŸ” Historique des sessions</span></div>
        <div class="schema-item-example" style="color:var(--muted); font-style:italic;">Session de recadrage sur CuriosityCrew. Correction de 5 bugs (imports, logging, Ã©criture, dÃ©tection gaps). Mise en place du format atomique/narratif.</div>
        <div class="schema-item-desc">RÃ©sumÃ© narratif de 2-4 phrases. Sous-section = date de session.</div>
      </div>
    </div>
  </div>
</div>
</div>

<div class="divider"></div>

<!-- â•â• PHILOSOPHIE â•â• -->
<section id="philosophy">
  <div class="reveal">
    <span class="section-label">Philosophie</span>
    <h2 class="section-title">ConÃ§u pour durer.<br>Pas pour impressionner.</h2>
    <p class="section-desc">Chaque dÃ©cision d'architecture a Ã©tÃ© prise pour la robustesse Ã  long terme : mÃ©moire Ã©ditable manuellement, zÃ©ro vendor lock-in, tests avant features.</p>
  </div>
  <div class="philosophy-grid reveal">
    <div class="phil-card">
      <div class="phil-icon">ğŸ“„</div>
      <div class="phil-title">memory.md comme source de vÃ©ritÃ©</div>
      <div class="phil-desc">La mÃ©moire reste un fichier Markdown lisible et Ã©ditable humainement. Versionnable avec git. SQLite est un index â€” pas la source. Les champs vides contiennent des notes d'intention pour l'agent.</div>
    </div>
    <div class="phil-card">
      <div class="phil-icon">ğŸ”’</div>
      <div class="phil-title">100% local, 100% privÃ©</div>
      <div class="phil-desc">Ollama en Docker, SQLite sur disque, aucun appel vers un service externe. Ce qui est dit Ã  Mnemo reste sur la machine.</div>
    </div>
    <div class="phil-card">
      <div class="phil-icon">ğŸ§ª</div>
      <div class="phil-title">Python avant LLM</div>
      <div class="phil-desc">RÃ©duire la surface LLM. La dÃ©tection de gaps, l'Ã©criture des rÃ©ponses du questionnaire, la validation des sections â€” tout ce qui peut Ãªtre fait en Python pur ne passe plus par un agent. Moins d'hallucinations, rÃ©sultat garanti.</div>
    </div>
    <div class="phil-card">
      <div class="phil-icon">ğŸ§ </div>
      <div class="phil-title">MÃ©moire â‰  base de donnÃ©es</div>
      <div class="phil-desc">La mÃ©moire personnelle et les documents ingÃ©rÃ©s sont sÃ©parÃ©s physiquement mais fusionnÃ©s dans le retrieval â€” pour que l'agent sache toujours d'oÃ¹ vient chaque information.</div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- â•â• PIPELINE â•â• -->
<div class="pipeline-section">
<div>
  <section id="pipeline" style="padding:0;">
    <div class="reveal">
      <span class="section-label">Architecture</span>
      <h2 class="section-title">3 crews, un seul but.</h2>
      <p class="section-desc">ConversationCrew pour chaque message, ConsolidationCrew en fin de session, CuriosityCrew pour combler les lacunes. Chaque agent a un rÃ´le unique et un modÃ¨le adaptÃ©.</p>
    </div>
    <div class="pipeline-flow reveal">
      <div class="pf-step">
        <div class="pf-num">01</div>
        <div class="pf-title">Ã‰valuateur</div>
        <div class="pf-desc">Analyse le message brut. Produit un JSON structurÃ© qui oriente tout le pipeline.</div>
        <div class="pf-tags"><span class="pf-tag">intent</span><span class="pf-tag">needs_memory</span></div>
        <div style="margin-top:12px; font-size:0.58rem; color:var(--muted);">âš™ qwen2.5:3b Â· rapide</div>
      </div>
      <div class="pf-step">
        <div class="pf-num">02</div>
        <div class="pf-title">Memory Retriever</div>
        <div class="pf-desc">Construit le contexte via <code>retrieve_all()</code> â€” mÃ©moire personnelle ET documents ingÃ©rÃ©s fusionnÃ©s par RRF.</div>
        <div class="pf-tags"><span class="pf-tag">ğŸ§  mÃ©moire</span><span class="pf-tag">ğŸ“„ documents</span></div>
        <div style="margin-top:12px; font-size:0.58rem; color:var(--muted);">âš™ qwen2.5:7b Â· tools</div>
      </div>
      <div class="pf-step">
        <div class="pf-num">03</div>
        <div class="pf-title">Agent Principal</div>
        <div class="pf-desc">Seul agent qui parle Ã  l'utilisateur. ReÃ§oit message + contexte enrichi.</div>
        <div class="pf-tags"><span class="pf-tag">rÃ©ponse finale</span></div>
        <div style="margin-top:12px; font-size:0.58rem; color:var(--muted);">âš™ qwen2.5:14b Â· qualitÃ© max</div>
      </div>
      <div class="pf-step">
        <div class="pf-num">04</div>
        <div class="pf-title">Consolidateur</div>
        <div class="pf-desc">En fin de session, extrait les faits. Format atomique ou narratif selon la section cible.</div>
        <div class="pf-tags"><span class="pf-tag">facts[]</span><span class="pf-tag">format prescrit</span></div>
        <div style="margin-top:12px; font-size:0.58rem; color:var(--muted);">âš™ qwen2.5:7b Â· raisonnement</div>
      </div>
      <div class="pf-step">
        <div class="pf-num">05</div>
        <div class="pf-title">CuriosityCrew</div>
        <div class="pf-desc">Python dÃ©tecte les gaps structurels (5/5 garanti). LLM dÃ©tecte les gaps contextuels. Questionnaire CLI collecte les rÃ©ponses. Ã‰criture Python directe.</div>
        <div class="pf-tags"><span class="pf-tag">structural</span><span class="pf-tag">contextual</span><span class="pf-tag">labels</span></div>
        <div style="margin-top:12px; font-size:0.58rem; color:var(--muted);">âš™ hybrid Python + LLM</div>
      </div>
    </div>
  </section>
</div>
</div>

<div class="divider"></div>

<!-- â•â• INGESTION â•â• -->
<section id="ingestion">
  <div class="reveal">
    <span class="section-label">Phase 2 â€” Perception</span>
    <h2 class="section-title">IngÃ©rer n'importe quel document.</h2>
    <p class="section-desc">Un seul dispatcher <code>ingest_file(path)</code> â€” dÃ©tection automatique du format, dÃ©duplication par hash MD5, pipeline commun.</p>
  </div>
  <div class="ingest-grid reveal">
    <div class="ing-card pdf">
      <div class="ing-icon">ğŸ“„</div>
      <div class="ing-title">PDF</div>
      <div class="ing-desc">Extraction page par page via pypdf. Nettoyage des cÃ©sures et espaces. Barre de progression.</div>
      <div class="ing-tags"><span class="ing-tag">pypdf</span><span class="ing-tag">clean_text()</span><span class="ing-tag">sliding window</span></div>
    </div>
    <div class="ing-card docx">
      <div class="ing-icon">ğŸ“</div>
      <div class="ing-title">DOCX</div>
      <div class="ing-desc">Paragraphes, headings prÃ©fixÃ©s <code>#</code> et tableaux via python-docx.</div>
      <div class="ing-tags"><span class="ing-tag">python-docx</span><span class="ing-tag">heading levels</span><span class="ing-tag">tables</span></div>
    </div>
    <div class="ing-card txt">
      <div class="ing-icon">ğŸ“ƒ</div>
      <div class="ing-title">TXT & Markdown</div>
      <div class="ing-desc">Lecture directe UTF-8. Pages fictives de ~500 mots. ZÃ©ro dÃ©pendance externe.</div>
      <div class="ing-tags"><span class="ing-tag">UTF-8</span><span class="ing-tag">500 mots/page</span></div>
    </div>
    <div class="ing-card code">
      <div class="ing-icon">ğŸ’»</div>
      <div class="ing-title">Code source</div>
      <div class="ing-desc">Python â†’ AST prÃ©cis. JS, TS, C, Java, shell â†’ regex patterns. Header langage dans chaque chunk.</div>
      <div class="ing-tags"><span class="ing-tag">.py .js .ts</span><span class="ing-tag">.c .cpp .java</span><span class="ing-tag">.sh .ps1</span></div>
    </div>
    <div class="ing-card retrieval">
      <div class="ing-icon">ğŸ”</div>
      <div class="ing-title">retrieve_all() â€” fusion globale</div>
      <div class="ing-desc">MÃ©moire personnelle + documents ingÃ©rÃ©s fusionnÃ©s par Reciprocal Rank Fusion. <code>ğŸ§ </code> mÃ©moire personnelle Â· <code>ğŸ“„ fichier.pdf â€” p.42</code> document.</div>
      <div class="flow-banner">
        <span class="fb-step" style="color:var(--a1);">ğŸ§  FTS5 + cosine mÃ©moire</span>
        <span class="fb-sep">+</span>
        <span class="fb-step" style="color:var(--a6);">ğŸ“„ FTS5 + cosine docs</span>
        <span class="fb-sep">â†’</span>
        <span class="fb-step">RRF Ã— importance Ã— freshness</span>
        <span class="fb-sep">â†’</span>
        <span class="fb-step">top K chunks</span>
      </div>
    </div>
    <div class="ing-card dedup">
      <div class="ing-icon">ğŸ”</div>
      <div class="ing-title">DÃ©duplication MD5</div>
      <div class="ing-desc">Hash MD5 du fichier entier. Double ingestion dÃ©tectÃ©e instantanÃ©ment. Chunk ID = hash(doc_id + page + index + contenu).</div>
      <div class="ing-tags"><span class="ing-tag">file_hash()</span><span class="ing-tag">is_already_ingested()</span></div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- â•â• STOCKAGE â•â• -->
<section id="stockage">
  <div class="reveal">
    <span class="section-label">Stockage</span>
    <h2 class="section-title">Deux mÃ©moires,<br>un seul retrieval.</h2>
  </div>
  <div class="storage-two reveal" style="margin-top:50px;">
    <div class="stor-card" style="border-color:rgba(247,183,49,0.3);">
      <div class="stor-title" style="color:var(--a3);">ğŸ“„ memory.md</div>
      <div class="stor-desc">Source de vÃ©ritÃ© humaine-lisible. Champs vides = notes d'intention pour l'agent. Format atomique sur les infos structurÃ©es, narratif sur les contextes riches.</div>
      <div class="stor-tags">
        <span class="stor-tag">ğŸ§‘ IdentitÃ© Utilisateur</span>
        <span class="stor-tag">ğŸ¤– IdentitÃ© Agent</span>
        <span class="stor-tag">ğŸ“š Connaissances</span>
        <span class="stor-tag">ğŸ” Historique sessions</span>
        <span class="stor-tag">âš ï¸ Ã€ ne jamais oublier</span>
      </div>
    </div>
    <div class="stor-card" style="border-color:rgba(124,106,247,0.3);">
      <div class="stor-title" style="color:var(--a1);">ğŸ—„ï¸ SQLite â€” 8 tables</div>
      <div class="stor-desc">Index double FTS5 + vectoriel (768d float32). Les 4 tables Phase 2 (violet) sont sÃ©parÃ©es mais participent au mÃªme retrieval.</div>
      <div class="stor-tags">
        <span class="stor-tag h1">chunks</span>
        <span class="stor-tag h1">embeddings</span>
        <span class="stor-tag h1">chunks_fts</span>
        <span class="stor-tag h1">sessions</span>
        <span class="stor-tag h1">session_facts</span>
        <span class="stor-tag h1">file_state</span>
        <span class="stor-tag h6">documents</span>
        <span class="stor-tag h6">doc_chunks</span>
        <span class="stor-tag h6">doc_embeddings</span>
        <span class="stor-tag h6">doc_chunks_fts</span>
      </div>
    </div>
  </div>
  <div class="rrf-banner reveal">
    <div class="rrf-title">retrieve_all(query, top_k_final=5)</div>
    <div class="rrf-flow">
      <span class="rrf-step">FTS5 keyword</span>
      <span class="rrf-sep">+</span>
      <span class="rrf-step">cosine similarity</span>
      <span class="rrf-sep">â†’</span>
      <span class="rrf-step">adaptive weights</span>
      <span class="rrf-sep">â†’</span>
      <span class="rrf-step">RRF Ã— importance Ã— freshness</span>
      <span class="rrf-sep">â†’</span>
      <span class="rrf-step">merge memory + docs</span>
      <span class="rrf-sep">â†’</span>
      <span class="rrf-step">top K chunks</span>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- â•â• BUGS â•â• -->
<div class="bugs-section">
<div>
  <section style="padding:0;">
    <div class="reveal">
      <span class="section-label">QualitÃ© Â· Total cumulÃ©</span>
      <h2 class="section-title">11 vrais bugs rÃ©glÃ©s.<br>Aucun inventÃ©.</h2>
      <p class="section-desc">Phase 1 : 6 bugs de production dÃ©tectÃ©s par les tests. Session d'aujourd'hui : 5 bugs supplÃ©mentaires dÃ©couverts Ã  l'usage.</p>
    </div>
    <div class="bugs-grid reveal">
      <div class="bug-card">
        <span class="bug-badge">BUG #1</span>
        <div class="bug-title">Perte silencieuse de chunks</div>
        <div class="bug-cause">Le dernier <code>###</code> de chaque <code>##</code> dans memory.md Ã©tait perdu lors du parsing. Des sous-sections entiÃ¨res n'Ã©taient jamais indexÃ©es en SQLite.</div>
        <div class="bug-fix">Sauvegarde du chunk courant avant reset Ã  chaque changement de section</div>
      </div>
      <div class="bug-card">
        <span class="bug-badge">BUG #2</span>
        <div class="bug-title">Crash sur query vide</div>
        <div class="bug-cause">SQLite FTS5 lÃ¨ve <code>OperationalError</code> sur une string vide. Pipeline entier plantait si l'Ã©valuateur produisait une <code>memory_query</code> vide.</div>
        <div class="bug-fix">Guard <code>if not query.strip(): return []</code> en tÃªte de <code>search_keyword()</code></div>
      </div>
      <div class="bug-card">
        <span class="bug-badge">BUG #3</span>
        <div class="bug-title">Collision de chunk_id</div>
        <div class="bug-cause">Hash MD5 sur le contenu seul : deux passages identiques dans un document produisaient le mÃªme ID â€” le second Ã©tait silencieusement skippÃ©.</div>
        <div class="bug-fix">Hash sur <code>doc_id:page:chunk_index:contenu</code> â€” chaque position unique</div>
      </div>
      <div class="bug-card">
        <span class="bug-badge">BUG #4</span>
        <div class="bug-title">AttributeError para.style</div>
        <div class="bug-cause">Paragraphes crÃ©Ã©s par copier-coller dans Word peuvent avoir <code>style=None</code>. Crash immÃ©diat Ã  l'ingestion de tout DOCX rÃ©el.</div>
        <div class="bug-fix">Guard triple <code>para.style and para.style.name and ...</code></div>
      </div>
      <div class="bug-card">
        <span class="bug-badge">BUG #5</span>
        <div class="bug-title">Fonctions courtes disparaissent</div>
        <div class="bug-cause">Seuil <code>MIN_CHUNK_LEN=80</code> filtrait des fonctions valides. Des pans entiers du code n'Ã©taient pas indexÃ©s.</div>
        <div class="bug-fix">Seuil dÃ©sactivÃ© pour le code â€” la structure sÃ©mantique prime sur la longueur</div>
      </div>
      <div class="bug-card">
        <span class="bug-badge">BUG #6</span>
        <div class="bug-title">Doublons AST walk()</div>
        <div class="bug-cause"><code>ast.walk()</code> descend rÃ©cursivement â€” les mÃ©thodes de classes Ã©taient indexÃ©es deux fois, causant du bruit dans le retrieval.</div>
        <div class="bug-fix">RemplacÃ© par <code>ast.iter_child_nodes()</code> â€” niveau module uniquement</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #7</span>
        <div class="bug-title">Import GapDetectionCrew inexistant</div>
        <div class="bug-cause"><code>main.py</code> importait deux noms qui n'ont jamais existÃ© dans <code>crew.py</code>. RÃ©sidu d'une version intermÃ©diaire. Plantait immÃ©diatement.</div>
        <div class="bug-fix">RemplacÃ© par <code>CuriosityCrew</code> partout</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #8</span>
        <div class="bug-title">_TeeStream cassait input()</div>
        <div class="bug-cause"><code>isatty()=False</code> hardcodÃ© + <code>fileno()</code> absent â†’ Python en mode non-interactif â†’ <code>EOFError</code> silencieuse â†’ questionnaire avortÃ© sans rien Ã©crire.</div>
        <div class="bug-fix">Suppression complÃ¨te du logging fichier et du _TeeStream</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #9</span>
        <div class="bug-title">update_markdown Ã©crasait tout</div>
        <div class="bug-cause">Chaque write remplaÃ§ait le bloc <code>###</code> entier. "France" â†’ tout le profil disparaissait, remplacÃ© par "France" brut.</div>
        <div class="bug-fix">Enrichissement si contenu rÃ©el existant, remplacement si placeholder uniquement</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #10</span>
        <div class="bug-title">Labels template = faux positifs</div>
        <div class="bug-cause"><code>"- **Nom/Pseudo** : pas encore renseignÃ©"</code> contient "nom" â†’ alias trouvÃ© â†’ champ considÃ©rÃ© rempli â†’ seulement 2 questions sur 5 dÃ©tectÃ©es.</div>
        <div class="bug-fix"><code>_line_is_real_value()</code> : alias sur placeholder ou label sans valeur â†’ ignorÃ©</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #11</span>
        <div class="bug-title">Question style en boucle infinie</div>
        <div class="bug-cause">ClÃ© <code>"prÃ©fÃ©rences"</code> ne correspondait Ã  aucun <code>##</code> dans le fichier â†’ <code>section_content</code> toujours vide â†’ gap toujours dÃ©tectÃ© â†’ reproposÃ© Ã  chaque session.</div>
        <div class="bug-fix">FusionnÃ© sous <code>"identitÃ© utilisateur"</code> â€” la vraie section parente dans le fichier</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #12</span>
        <div class="bug-title">Header ### matchait comme alias rÃ©el</div>
        <div class="bug-cause"><code>_extract_section_content()</code> retourne tout en lowercase y compris <code>### prÃ©fÃ©rences &amp; style</code>. L'alias <code>"style"</code> trouvÃ© dans le titre â†’ <code>_line_is_real_value()</code> â†’ True â†’ champ jamais dÃ©tectÃ© comme vide. RÃ©vÃ©lÃ© par les tests unitaires.</div>
        <div class="bug-fix">Skip explicite des lignes <code>#</code> dans <code>_detect_structural_gaps</code> â€” les titres de sous-section ne sont plus analysÃ©s</div>
      </div>
      <div class="bug-card" style="border-color:rgba(247,183,49,0.15);">
        <span class="bug-badge" style="background:rgba(247,183,49,0.15); border-color:rgba(247,183,49,0.3); color:var(--a3);">SESSION #13</span>
        <div class="bug-title">Merge Ã©crasait les vraies valeurs</div>
        <div class="bug-cause"><code>is_placeholder = True</code> si UNE ligne du bloc contient un marqueur. Profil avec "Matt" + deux placeholders â†’ <code>merged = content</code> â†’ Matt effacÃ© silencieusement. RÃ©vÃ©lÃ© par les tests unitaires.</div>
        <div class="bug-fix">Filtrage ligne par ligne : <code>real_lines</code> = lignes sans marqueur. Merge = rÃ©elles + nouveau contenu. Valeurs existantes toujours prÃ©servÃ©es</div>
      </div>
    </div>
  </section>
</div>
</div>

<div class="divider"></div>

<!-- â•â• TESTS â•â• -->
<section id="tests">
  <div class="reveal">
    <span class="section-label">Tests</span>
    <h2 class="section-title">388 tests.<br>ZÃ©ro appel Ollama requis.</h2>
    <p class="section-desc">Chaque fichier est testable sans infrastructure externe grÃ¢ce aux mocks. Le marqueur <code>@pytest.mark.ollama</code> isole les tests nÃ©cessitant le vrai modÃ¨le.</p>
  </div>
  <div class="tests-grid reveal">
    <div class="test-card">
      <div class="test-num">66</div>
      <div class="test-file">test_memory_tools.py</div>
      <div class="test-desc">Briques bas niveau : sanitize, hash, parsing Markdown, sessions, freshness, importance</div>
    </div>
    <div class="test-card">
      <div class="test-num">40</div>
      <div class="test-file">test_retrieval.py</div>
      <div class="test-desc">Retrieval hybride : RRF, cosine, FTS5, adaptive weights (30 offline + 10 @ollama)</div>
    </div>
    <div class="test-card">
      <div class="test-num">25</div>
      <div class="test-file">test_session_cycle.py</div>
      <div class="test-desc">Cycle complet : crews mockÃ©s, sessions orphelines, scÃ©narios bout en bout</div>
    </div>
    <div class="test-card" style="border-color:rgba(249,122,249,0.3);">
      <div class="test-num" style="color:var(--a6);">89</div>
      <div class="test-file" style="color:var(--a6);">test_ingest_tools.py âœ¦</div>
      <div class="test-desc">Pipeline ingestion : chunking, hash, DB, PDF/DOCX/TXT/code source, dispatcher</div>
    </div>
    <div class="test-card" style="border-color:rgba(247,183,49,0.3);">
      <div class="test-num" style="color:var(--a3);">79</div>
      <div class="test-file" style="color:var(--a3);">test_curiosity.py âœ¦</div>
      <div class="test-desc">CuriosityCrew : gaps structurels, _line_is_real_value, upsert label, skip DB, collect_answers mockÃ©</div>
    </div>
    <div class="test-card" style="border-color:rgba(78,205,196,0.3);">
      <div class="test-num" style="color:var(--a2);">89</div>
      <div class="test-file" style="color:var(--a2);">test_calendar_tools.py âœ¦</div>
      <div class="test-desc">Calendrier : datetime FR (7 jours Ã— 12 mois), ICS parsing, cache TTL, fetch mock URL/local, formatage banniÃ¨re</div>
    </div>
  </div>
  <div class="test-total reveal">
    <div><div class="tt-label">Total</div><div class="tt-num">388 tests âœ…</div></div>
    <div class="tt-bar-wrap"><div class="tt-bar" style="width:100%"></div></div>
    <div style="font-size:0.65rem; color:var(--muted);">0 fails Â· 0 flaky Â· pytest 9.0</div>
  </div>
</section>

<div class="divider"></div>

<!-- â•â• ROADMAP â•â• -->
<section id="roadmap">
  <div class="reveal">
    <span class="section-label">Roadmap</span>
    <h2 class="section-title">OÃ¹ on en est.</h2>
  </div>
  <div class="roadmap-track reveal">
    <div class="rm-phase rm-done">
      <div class="rm-phase-num">0</div>
      <span class="rm-status">âœ“ ComplÃ¨te</span>
      <div class="rm-title">Fondations</div>
      <ul class="rm-items">
        <li class="done">MÃ©moire hybride FTS5 + vectoriel</li>
        <li class="done">RRF Â· importance Â· freshness</li>
        <li class="done">CTRL+C â†’ finally â†’ consolidation</li>
        <li class="done">Unicode sanitize</li>
        <li class="done">Ollama Docker Â· num_ctx 8192</li>
      </ul>
    </div>
    <div class="rm-phase rm-done">
      <div class="rm-phase-num">1</div>
      <span class="rm-status">âœ“ ComplÃ¨te</span>
      <div class="rm-title">Stabilisation</div>
      <ul class="rm-items">
        <li class="done">220 tests (niveaux 1-4)</li>
        <li class="done">6 bugs corrigÃ©s</li>
        <li class="done">Architecture validÃ©e</li>
        <li class="done">Tests avant features</li>
      </ul>
    </div>
    <div class="rm-phase rm-active">
      <div class="rm-phase-num">2</div>
      <span class="rm-status">â— En cours</span>
      <div class="rm-title">Perception & MÃ©moire</div>
      <ul class="rm-items">
        <li class="done">Ingestion PDF / DOCX / TXT / MD</li>
        <li class="done">Ingestion code source (11 ext.)</li>
        <li class="done">retrieve_all() Â· 89 tests</li>
        <li class="done">CuriosityCrew hybride Python+LLM</li>
        <li class="done">Format atomique / narratif</li>
        <li class="done">memory.md auto-suggestion</li>
        <li class="done">Conscience temporelle</li>
        <li class="wip">Web occasionnel (SearXNG)</li>
      </ul>
    </div>
    <div class="rm-phase rm-next">
      <div class="rm-phase-num">3</div>
      <span class="rm-status">â¬œ PlanifiÃ©e</span>
      <div class="rm-title">Action</div>
      <ul class="rm-items">
        <li>Dashboard web local</li>
        <li>Router pattern</li>
        <li>Outils shell</li>
        <li>Scheduler</li>
      </ul>
    </div>
    <div class="rm-phase rm-next">
      <div class="rm-phase-num">4</div>
      <span class="rm-status">â¬œ PlanifiÃ©e</span>
      <div class="rm-title">Interfaces</div>
      <ul class="rm-items">
        <li>REST API (FastAPI)</li>
        <li>Local TTS / STT</li>
        <li>Raspberry PI embedding</li>
        <li>Unity Integration</li>
      </ul>
    </div>
    <div class="rm-phase rm-next">
      <div class="rm-phase-num">5</div>
      <span class="rm-status">â¬œ PlanifiÃ©e</span>
      <div class="rm-title">ProactivitÃ©</div>
      <ul class="rm-items">
        <li>Suggestions contextualisÃ©es</li>
        <li>DÃ©tection de routines</li>
        <li>Alertes de deadlines</li>
        <li>Compression memory.md</li>
        <li>Multi-profils</li>
      </ul>
    </div>
  </div>
</section>

<div class="divider"></div>

<footer>
  <div class="footer-logo">Mnemo</div>
  <div class="footer-sub">Agent mÃ©moire personnel Â· 100% local Â· 100% privÃ© Â· session 2026-02-27 v4</div>
  <div class="footer-stack">
    <span class="fs-tag">CrewAI â‰¥ 0.130</span>
    <span class="fs-tag">Ollama â‰¥ 0.4</span>
    <span class="fs-tag">SQLite Â· FTS5</span>
    <span class="fs-tag">nomic-embed-text Â· 768d</span>
    <span class="fs-tag">pypdf</span>
    <span class="fs-tag">python-docx</span>
    <span class="fs-tag">numpy â‰¥ 1.26</span>
    <span class="fs-tag">pytest 9.0</span>
    <span class="fs-tag">Python 3.12</span>
  </div>
</footer>

<script>
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.12 });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
</script>
</body>
</html>
